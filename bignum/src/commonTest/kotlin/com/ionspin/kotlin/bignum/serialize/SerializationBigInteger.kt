package com.ionspin.kotlin.bignum.serialize

import com.ionspin.kotlin.bignum.integer.BigInteger
import com.ionspin.kotlin.bignum.integer.toBigInteger
import kotlinx.serialization.Serializable
import kotlinx.serialization.decodeFromString
import kotlinx.serialization.encodeToString
import kotlinx.serialization.json.Json
import kotlin.test.Test
import kotlin.test.assertEquals

class SerializationBigInteger {
    @Serializable
    data class BigIntegers(
        val one: BigInteger,
        val two: BigInteger,
        val tree: BigInteger
    )

    @Test
    fun testBigIntegerSerialization() {
        val originData = BigIntegers(
            one = BigInteger.tryFromDouble(42.27),
            two = Long.MAX_VALUE.toBigInteger() + 10,
            tree = BigInteger.parseString(
                "3524971412108382657134814839800281546439142134396647106039138260573107027685474936504833029647366386245" +
                        "69681553952983739732590494759431136198883386731161336668147068707652719076562056460186083699855" +
                        "58721267670321739031938633833281889192620158426531806923144239269726876399951961191980348023291" +
                        "70347230576378241039458975893458563111107812043530303268881875144643529137135717175563277536293" +
                        "26947950763134366874696380043276893902467353218558306108568659249137608267637760032658517165573" +
                        "34210642277343475757799780499021559822412434275087084317293455129570406707590002071704673135527" +
                        "53354321735598756810769757794678579641245604836007296561687102486624465008105906818303813451851" +
                        "42229871868373945980198595129936003792361901975768389050807333599890946870089994162477220200619" +
                        "92559931401872357379708488585003666965930609730430774107407494018065365845077094320534700692354" +
                        "40016982413157838915365691675468225242556274289502682208611223618576893194043332407869238646364" +
                        "23780292915823845509040122842652771246674528169856593374975809915925102014797665008774278345666" +
                        "19156314388107585743546289067551052434075678195345373363919571323210113622615511765134329627207" +
                        "95579360537689287593835767287088130567930552129335997542780192199753489147409086811346735778435" +
                        "97833830910857171008072284250312267769851973643594046830415066139436466661994548993636858018487" +
                        "76729685837803228216113833854742443409221480450232563130417709625320794971672737737385983975520" +
                        "04773997816512490691685793196090240739784153665765037875801240915720593951308532428243929010890" +
                        "90690365154306903599631529865877499305168806703261450369876070529616967815564185509662018228218" +
                        "57978020062536824015697620957222738065538832187097409859502669196589025961199448758997373792973" +
                        "19172333554977239487887405085453278592247582283640379398662319317402093143238141843702276041268" +
                        "22763829893548396254532412898071082609051342346791309548675704473545497601746910070785284527450" +
                        "27994943853229480544512368831378761119681616719327637308142315105120528704683515182038320225078" +
                        "66531391173174936425562128443430494543721460940600864052097202950995543556809488881570147041941" +
                        "08891565239711821728144232741409554280705943283816670482867719728577034355258035447078345677740" +
                        "27206614143419982410109261930698311010857874866840743851472857645330929169548403751084494725893" +
                        "72935545047377105998680105834202190273536762790097487236813783899639737989816145482597091073285" +
                        "82027812829739376428479733818386729806933990394293426130015951489680820100160610223162428423676" +
                        "72741265405434553107296623559604413326352140529618171175450657884255099334618722731697920185582" +
                        "43718239139767330116816068251663921470656698146596173137480894913174236475299307832636771411700" +
                        "14042109302515381324422193350726720968651846913030271569624397770537072865839497640551512918164" +
                        "02546462452719134797179099210233577596277925646031824172274874084562113440043397395191065473620" +
                        "71710425068604089658092870084259391917328384453147095220560087448230248852386707453290778126499" +
                        "08653518446848070122080391082875645348545004863915388760636114766656202302948114683518353740720" +
                        "60530215907909311281816131942219776", 10
            )
        )
        val jsonSting = Json.encodeToString(originData)
        val serializedData = Json.decodeFromString<BigIntegers>(jsonSting)
        assertEquals(originData, serializedData)
    }
}
